<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>DADA 3</title>
    <style>
      @font-face {
        font-family: "GTFAdieu Black";
        src: url("./fonts/GTFAdieuTRIAL-Black.otf") format("opentype");
        font-weight: normal;
        font-style: normal;
      }

      @font-face {
        font-family: "GTFAdieu Bold";
        src: url("./fonts/GTFAdieuTRIAL-Bold.otf") format("opentype");
        font-weight: bold;
        font-style: normal;
      }

      @font-face {
        font-family: "GTFEkstra Medium";
        src: url("./fonts/GTFEkstraTRIAL-Medium.otf") format("opentype");
        font-weight: normal;
        font-style: medium;
      }

      body {
        font-family: "GTFAdieu Black", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        margin: 0;
        background-color: black;
        flex-direction: column;
      }

      .scene {
        width: 80vw;
        height: 100vh;
        perspective: 1000px;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000000000;
      }

      .cube {
        position: relative;
        width: 80vw;
        height: 100vh;
        transform-style: preserve-3d;
        transform: rotateX(0deg); /* Initial rotation */
        transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1);
      }
      .face {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 50px;
        text-transform: uppercase;
        box-sizing: border-box;
        cursor: pointer;
      }

      .face:nth-child(1) {
        transform: rotateX(0deg) translateZ(50vh);
      }
      .face:nth-child(2) {
        transform: rotateX(90deg) translateZ(50vh);
      }
      .face:nth-child(3) {
        transform: rotateX(180deg) translateZ(50vh);
      }
      .face:nth-child(4) {
        transform: rotateX(-90deg) translateZ(50vh);
      }

      .image-throw {
        position: absolute;
        transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
        transform: rotate(0deg);
        max-height: 100vh;
      }

      img,
      video {
        height: 100%;
        width: 100%;
      }

      .face {
        opacity: 0;
        transition: opacity 0.5s cubic-bezier(0.25, 1, 0.5, 1);
      }

      .active {
        opacity: 1;
        color: white;
      }

      .loader {
        background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 1) 0%,
            rgb(255 255 255) 100%
          ),
          #ffffff74;
        -webkit-background-clip: text;
        color: transparent;
        transition: background-size 0.5s ease;
        background-size: 0% 100%;
        background-position: left;
        background-repeat: no-repeat;
      }

      .inactive {
        opacity: 0.5;
        background-size: 0% 100%; /* Start with 0% background size */
        background-position: left;
        background-repeat: no-repeat;
      }

      .next-button {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        z-index: 1000;
        font-size: 1.5rem;
        padding: 0.5rem;
        align-items: center;
        padding-bottom: 0.1rem;
        padding-top: 0.2rem;
        border-radius: 0.25rem;
        gap: 0.25rem;
        overflow: hidden;
        cursor: pointer;
        font-family: "GTFAdieu Bold";
      }

      header {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        font-size: 1.5rem;
        padding: 0.5rem;
        align-items: center;
        padding-bottom: 0.1rem;
        padding-top: 0.2rem;
        border-radius: 0.25rem;
        gap: 0.25rem;
        overflow: hidden;
        cursor: pointer;
        font-family: "GTFAdieu Bold";
        display: flex;
        color: white;
        justify-content: space-between;
        width: 100%;
        box-sizing: border-box;
        padding: 1rem;
        z-index: 1000000010;
      }

      .load-bar {
        position: absolute;
        left: 0;
        width: 0;
        height: 100%;
        background-color: white;
        z-index: -1;
        transition: width 0.5s ease;
      }

      .loader-wrapper {
        display: flex;
        padding: 1rem;
        position: fixed;
        top: 0;
        box-sizing: border-box;
        width: 100%;
        height: 1rem;
      }

      .fake-next-one {
        height: 100vh;
        width: 100vw;
        text-transform: uppercase;
        background-color: rgb(179 179 179 / 10%);
        backdrop-filter: blur(20px);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 91px;
        color: white;
        position: fixed;
        border-radius: 1rem;
        transform: scale(0.1);
        transform-origin: bottom right;
        z-index: 1000000009;
        bottom: 1rem;
        right: 1rem;
        transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
        transition-delay: 1.5s;
      }

      .loading-bar {
        height: 0.5rem;
        position: absolute;
        bottom: 0;
        width: 100%;
      }

      .loading-bar .loader-inside {
        width: 0;
        background-color: white;
        transition: width 0.2s ease-in-out;
      }

      .grow-dataset .fake-next-one {
        transform: scale(1);
        bottom: 0;
        right: 0;
        background-color: transparent;
        backdrop-filter: none;
      }

      .grow-dataset .loading-bar {
        opacity: 0;
        transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
        transition-delay: 1s;
      }

      .loader-inside {
        height: 100%;
      }

      .grow-dataset .active {
        opacity: 0;
        transition-delay: 1.4s;
      }
    </style>
  </head>
  <body>
    <header><span>DADA</span><span>INFO</span></header>
    <div class="next-button" >
      <div class="load-bar" style="width: 0%"></div>
      <span class="heading">Next Up</span>
    </div>

    <div class="fake-next-one">
     A New Building
     <div class="loading-bar">
      <div class="loader-inside"></div>
     </div>
    </div>
    <div class="loader-wrapper">
      <span class="loader"></span>
    </div>

    <div class="scene">
      <div class="cube">
        <div class="face active">A NIGHT OUT</span></div>
        <div class="face"><span class="loader"></span>A NEW BUILDING</span></div>
        <div class="face"><span class="loader"></span>A BEAUTIFUL HOME</span></div>
        <div class="face"><span class="loader"></span>A NEW LOOK</span></div>
      </div>
    </div>

    <script>
      // Datasets for each cube face
      const mediaDatasets = {
        "A NIGHT OUT": [
          "./a-night-out-img/01.jpg",
          "./a-night-out-img/02.jpg",
          "./a-night-out-img/03.mp4",
          "./a-night-out-img/04.jpg",
          "./a-night-out-img/05.png",
          "./a-night-out-img/06.jpg",
          "./a-night-out-img/07.jpg",
          "./a-night-out-img/08.jpg",
          "./a-night-out-img/09.jpg",
          "./a-night-out-img/10.jpg",
          "./a-night-out-img/11.mp4",
          "./a-night-out-img/12.png",
          "./a-night-out-img/13.jpg",
          // "./a-night-out-img/13.jpg",
          "./a-night-out-img/14.jpg",
          "./a-night-out-img/15.jpg",
        ],
        "A NEW BUILDING": [
        "./a-new-building-img/01.jpg",
          "./a-new-building-img/02.mp4",
          "./a-new-building-img/03.jpg",
          "./a-new-building-img/04.jpg",
          "./a-new-building-img/05.jpg",
          "./a-new-building-img/06.jpg",
          "./a-new-building-img/07.png",
          "./a-new-building-img/08.jpg",
          "./a-new-building-img/09.jpg",
          "./a-new-building-img/10.mp4",
          "./a-new-building-img/11.jpg",
          "./a-new-building-img/12.jpg",
          "./a-new-building-img/13.mp4",
          // "./a-new-building-img/13.jpg",
          // "./a-new-building-img/14.jpg",
          // "./a-new-building-img/15.jpg",

          // Add the rest of the files from a-new-building-img...
        ],
        "A BEAUTIFUL HOME": [
          "./a-beautiful-home-img/01.jpg",
          "./a-beautiful-home-img/02.jpg",
          "./a-beautiful-home-img/03.jpg",
          "./a-beautiful-home-img/04.jpg",
          "./a-beautiful-home-img/05.jpg",

          "./a-beautiful-home-img/06.jpg",
          "./a-beautiful-home-img/07.jpg",
          "./a-beautiful-home-img/08.jpg",
          "./a-beautiful-home-img/09.jpg",
          "./a-beautiful-home-img/10.mp4",

          // Add the rest of the files from a-beautiful-home-img...
        ],
        "A NEW LOOK": [
          "./a-new-look-img/01.png",
          "./a-new-look-img/02.png",
          "./a-new-look-img/03.png",
          "./a-new-look-img/04.png",
          // Add the rest of the files from a-new-look-img...
        ],
      };
      let availableMedia = [];
let thrownMediaCount = 0;
let highestZIndex = 1000;

const MAX_WIDTH = 400;
const MAX_HEIGHT = 300;
const INITIAL_STACK_WIDTH = 50;
const STACK_OFFSET = 15;

let throwIsDone = false;
let currentDatasetName = "";  // Track the current dataset name
let currentDatasetTotal = 0;  // Keep track of the total media for the current dataset

// Update loader progress and check if all media have been thrown
function updateLoaderProgress() {
  const totalMedia = currentDatasetTotal;  // Track the correct total for the current dataset
  const progressPercentage = (thrownMediaCount / totalMedia) * 100;
  const loadingBar = document.querySelector('.fake-next-one .loader-inside');
  if (loadingBar) loadingBar.style.width = `${progressPercentage}%`;

  // Check if all media have been thrown for the current dataset
  if (thrownMediaCount === totalMedia) {
    console.log('THROWN MEDIA:' + thrownMediaCount);
    console.log('TOTAL MEDIA:' + totalMedia);

    throwIsDone = true;
    setTimeout(() => {
      if (loadingBar) loadingBar.style.width = `100%`;
    }, 500);

    // When all media has been thrown, display the next button
    if (throwIsDone) displayNextButton();
  }
}

function displayNextButton() {
  const nextButton = document.querySelector('.next-button');
  nextButton.style.display = 'flex';
  document.body.addEventListener('click', () => {
    document.body.classList.add('grow-dataset');
    const mediaDivs = document.querySelectorAll('.image-stack');
    if (currentDatasetName !== "A NEW BUILDING") {
      // Remove media only for datasets other than "A NEW BUILDING"
      removeImage(mediaDivs); // Remove all media only after dataset is complete
    } else {
      console.log('Skipping media removal for "A NEW BUILDING".');
      // For "A NEW BUILDING", skip the removal and proceed to the next step (if needed)
    }
  });
}

// Remove media only when all media have been thrown
function removeImage(mediaDivs) {
  const reversedMediaDivs = Array.from(mediaDivs).reverse();

  reversedMediaDivs.forEach((mediaDiv, index) => {
    setTimeout(() => {
      mediaDiv.style.transform = "scale(0)";
      mediaDiv.style.transition = "transform 1s cubic-bezier(0.25, 1, 0.5, 1)";
      console.log('Media is being removed');

      // Trigger the new dataset setup after all media is removed
      if (index === reversedMediaDivs.length - 1) {
        setTimeout(() => {
          setupNewDatasetAfterScale(); // Setup the next dataset after all media is removed
        }, 500); // Delay for smoother transition
      }
    }, index * 80); // Staggered media removal
  });
}

function throwMedia(mediaDiv, clickEvent) {
  const randomAngle = Math.random() * 10 - 5;
  const scaleFactor = Math.random() * (10 - 8) + 8;
  const offset = 30;
  const endPosX = clickEvent.clientX - mediaDiv.clientWidth / 2 - offset;
  const endPosY = clickEvent.clientY - mediaDiv.clientHeight / 2 - offset;
  mediaDiv.style.zIndex = ++highestZIndex;
  mediaDiv.style.transition = "all 1.5s cubic-bezier(0.25, 1, 0.5, 1)";
  mediaDiv.style.left = `${endPosX}px`;
  mediaDiv.style.top = `${endPosY}px`;
  mediaDiv.style.transform = `scale(${scaleFactor}) rotate(${randomAngle}deg)`;
  mediaDiv.firstChild.style.maxWidth = `${MAX_WIDTH}px`;
  mediaDiv.firstChild.style.maxHeight = `${MAX_HEIGHT}px`;
  mediaDiv.classList.add("thrown");
  thrownMediaCount++;  // Increment count when media is thrown
  updateLoaderProgress();  // Check progress after every throw
}

function followMouse(mediaDiv) {
  mediaDiv.style.zIndex = ++highestZIndex;
  document.addEventListener("mousemove", (event) => {
    if (!mediaDiv.classList.contains("thrown")) {
      mediaDiv.style.left = `${event.clientX + 10}px`;
      mediaDiv.style.top = `${event.clientY + 10}px`;
    }
  });
}

function loadAndFollowNextMedia() {
  const mediaDivs = Array.from(document.querySelectorAll(".image-stack"));
  const nextMedia = mediaDivs.find((mediaDiv) => !mediaDiv.classList.contains("thrown"));
  if (nextMedia) {
    nextMedia.style.display = "block";
    followMouse(nextMedia);
    document.addEventListener("click", (event) => {
      throwMedia(nextMedia, event);
      loadAndFollowNextMedia();  // Continue the process until all media are thrown
    }, { once: true });
  }
}

function stackMediaOnLoad() {
  if (availableMedia.length === 0) return;
  availableMedia.forEach((mediaUrl, index) => {
    const mediaDiv = document.createElement("div");
    mediaDiv.classList.add("image-stack");
    mediaDiv.style.position = "fixed";
    mediaDiv.style.width = `${INITIAL_STACK_WIDTH}px`;
    mediaDiv.style.left = `${window.innerWidth / 2 - INITIAL_STACK_WIDTH / 2}px`;
    mediaDiv.style.top = `${window.innerHeight / 2 + index * STACK_OFFSET}px`;
    mediaDiv.style.zIndex = 1000 - index;
    let mediaElement;
    if (mediaUrl.endsWith(".mp4")) {
      mediaElement = document.createElement("video");
      mediaElement.src = mediaUrl;
      mediaElement.autoplay = true;
      mediaElement.loop = true;
      mediaElement.muted = true;
    } else {
      mediaElement = document.createElement("img");
      mediaElement.src = mediaUrl;
    }
    mediaDiv.appendChild(mediaElement);
    mediaDiv.style.display = "none";
    document.body.appendChild(mediaDiv);
  });
}

function startThrowingAndStacking(mediaDataset, datasetName) {
  availableMedia = [...mediaDataset];
  currentDatasetTotal = availableMedia.length;  // Set the total media for the current dataset
  thrownMediaCount = 0;  // Reset thrown media count for new dataset
  throwIsDone = false;   // Reset throwIsDone for the new dataset
  currentDatasetName = datasetName; // Set the current dataset name
  stackMediaOnLoad();
  loadAndFollowNextMedia();  // Start throwing new media
}

// Reset everything and start with a new dataset
function resetThrowingWithNewDataset(newDataset, datasetName) {
  const mediaDivs = document.querySelectorAll('.image-stack');
  mediaDivs.forEach(mediaDiv => mediaDiv.remove());
  thrownMediaCount = 0; // Reset thrown media count for the new dataset
  throwIsDone = false;  // Reset throw status
  availableMedia = [...newDataset];
  currentDatasetTotal = availableMedia.length;  // Reset total for the new dataset
  const loadingBar = document.querySelector('.fake-next-one .loader-inside');
  if (loadingBar) loadingBar.style.width = '0%';
  setTimeout(() => {  // Delay for dataset reset to give it a smoother transition
    startThrowingAndStacking(newDataset, datasetName);  // Restart throwing for the new dataset
  }, 1000); // Ensure transition delay for smoother experience
}

// Function to detect when transition ends and set up the next dataset
function setupNewDatasetAfterScale() {
  const fakeNextOne = document.querySelector('.fake-next-one');
  fakeNextOne.addEventListener('transitionend', (event) => {
    if (event.propertyName === 'transform' && 
        window.getComputedStyle(fakeNextOne).transform === 'matrix(1, 0, 0, 1, 0, 0)') {
      console.log('Fake-next-one scaled to 1, loading new dataset...');
      resetThrowingWithNewDataset(mediaDatasets["A NEW BUILDING"], "A NEW BUILDING");
    }
  });
}

// Start with the first dataset
setupNewDatasetAfterScale();
startThrowingAndStacking(mediaDatasets["A NIGHT OUT"], "A NIGHT OUT");
    </script>
  </body>
</html>
    